<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Play</title>
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.4.1/jquery.min.js"></script>
    <script src="../js/own/record.js"></script>
</head>
<body onbeforeunload="unload();">
<video autoplay="autoplay" id="videoElement" style="display: none">
</video>
<audio muted autoplay="autoplay" id="audioElement" style="display: none">
</audio>
<p>Hello <span id="username"></span>!</p>
<p>Video and audio recording has started; when you leave this webpage, an audio and a video file will be downloaded</p>

<script>
    let video = document.querySelector("#videoElement");
    let audio = document.querySelector("#audioElement");
    $("#username").html(sessionStorage.getItem('username'));
    if (navigator.mediaDevices.getUserMedia) {
        navigator.mediaDevices.getUserMedia({video: true})
            .then(function (str) {
                video.srcObject = str;
                let options = {mimeType: "video/webm; codecs=vp9"};
                mediaRecorderVideo = new MediaRecorder(video.captureStream(), options);

                mediaRecorderVideo.ondataavailable = handleDataAvailableVideo;
                mediaRecorderVideo.start();

            })
            .catch(function (error) {
                alert(error.message + " video");
                alert("For this app to work, we need your permission to access your webcam and microphone!")
            });

        navigator.mediaDevices.getUserMedia({audio: true})
            .then(function (str) {
                audio.srcObject = str;
                let options = {mimeType: "audio/webm"};
                mediaRecorderAudio = new MediaRecorder(audio.captureStream(), options);

                mediaRecorderAudio.ondataavailable = handleDataAvailableAudio;
                mediaRecorderAudio.start();

            })
            .catch(function (error) {
                alert(error.message + " audio");
                alert("For this app to work, we need your permission to access your webcam and microphone!")
            });
    }
    let recordedChunksVideo = [];
    let recordedChunksAudio = [];
</script>
</body>
</html>

